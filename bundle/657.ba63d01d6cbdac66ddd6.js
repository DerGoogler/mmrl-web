"use strict";(self.webpackChunkcom_dergoogler_mmrl_web=self.webpackChunkcom_dergoogler_mmrl_web||[]).push([[657],{17657:(e,t,n)=>{n.r(t),n.d(t,{InstallTerminalV2Activity:()=>H,default:()=>z});var r,o=n(74848),s=n(76437),a=n(19907),i=n(93328),l=n(13272),c=n(91241),m=n(84719),u=n(30995),d=n(24279),p=n(33551),h=n(22112),g=n(7548),f=n.n(g),E=n(96540),_=new Uint8Array(16);function x(){if(!r&&!(r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(_)}for(var b=[],v=0;v<256;++v)b.push((v+256).toString(16).slice(1));function R(e,t=0){return(b[e[t+0]]+b[e[t+1]]+b[e[t+2]]+b[e[t+3]]+"-"+b[e[t+4]]+b[e[t+5]]+"-"+b[e[t+6]]+b[e[t+7]]+"-"+b[e[t+8]]+b[e[t+9]]+"-"+b[e[t+10]]+b[e[t+11]]+b[e[t+12]]+b[e[t+13]]+b[e[t+14]]+b[e[t+15]]).toLowerCase()}var L,w,I=0,M=0;const A=function(e,t,n){var r=t&&n||0,o=t||new Array(16),s=(e=e||{}).node,a=e.clockseq;if(e._v6||(s||(s=L),null==a&&(a=w)),null==s||null==a){var i=e.random||(e.rng||x)();null==s&&(s=[i[0],i[1],i[2],i[3],i[4],i[5]],L||e._v6||(s[0]|=1,L=s)),null==a&&(a=16383&(i[6]<<8|i[7]),void 0!==w||e._v6||(w=a))}var l=void 0!==e.msecs?e.msecs:Date.now(),c=void 0!==e.nsecs?e.nsecs:M+1,m=l-I+(c-M)/1e4;if(m<0&&void 0===e.clockseq&&(a=a+1&16383),(m<0||l>I)&&void 0===e.nsecs&&(c=0),c>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");I=l,M=c,w=a;var u=(1e4*(268435455&(l+=122192928e5))+c)%4294967296;o[r++]=u>>>24&255,o[r++]=u>>>16&255,o[r++]=u>>>8&255,o[r++]=255&u;var d=l/4294967296*1e4&268435455;o[r++]=d>>>8&255,o[r++]=255&d,o[r++]=d>>>24&15|16,o[r++]=d>>>16&255,o[r++]=a>>>8|128,o[r++]=255&a;for(var p=0;p<6;++p)o[r+p]=s[p];return t||R(o)};var C=n(15241),S=n(29559),y=n(78567),k=n(38206),$=n(96857),N=n(51629),T=n(69907),j=n(64483),D=n(82326),U=n(48043),B=n(34853);const P=E.createContext({processCommand:e=>"",lines:[],setLines(){},addButton(e,t){},addText(e,t){},setLastLine(e,t){},rebootDevice(e){},getInstallCLI:e=>"exit "+T.$.TERM_INTR_ERR,clearTerminal(){}}),O={R:"[0m",BRIGHT:"[1m",DIM:"[2m",UNDERSCORE:"[4m",FG:{BLACK:"[30m",RED:"[31m",GREEN:"[32m",YELLOW:"[33m",BLUE:"[34m",MAGENTA:"[35m",CYAN:"[36m",WHITE:"[37m",GRAY:"[90m"},BG:{BLACK:"[40m",RED:"[41m",GREEN:"[42m",YELLOW:"[43m",BLUE:"[44m",MAGENTA:"[45m",CYAN:"[46m",WHITE:"[47m",GRAY:"[100m"}},F=e=>{const{strings:t}=(0,$.k)(),{modFS:n,modFSParse:r}=(0,k.vQ)(),[s,a]=E.useState(!1),[i,l]=E.useState([]),c=(0,U.SC)(),{children:m}=e,u=(e,t)=>{const n=g(e);"string"==typeof n&&"undefined"!==n&&l((e=>[...e,{component:S.A,props:{children:n,sx:{mr:1,ml:1},linkify:!0,...t}}]))},d=(e,t)=>{l((e=>e.slice(0,-1))),u(e,t)},p=(e,t)=>{l((n=>[...n,{component:N.A,props:{children:e,variant:"contained",sx:{width:"50vmin",mt:1,mb:1},...t}}]))},h=E.useMemo((()=>({addImage:e=>(((e,t)=>{"string"==typeof e&&l((n=>[...n,{component:y._,props:{src:e,noOpen:!0,sx:{mr:1,ml:1},...t}}]))})(e),"undefined"),setLastLine:e=>(void 0===e||d(e),"undefined"),color:e=>void 0===e?"undefined":B.default.format(e,O),clearTerminal:()=>(l([]),"undefined"),removeLastLine:()=>(l((e=>e.slice(0,-1))),"undefined")})),[]),g=e=>{if(e.startsWith("#!mmrl:"))return e=e.substring(7),B.default.format(e,h);{const t=/^\-(\s+)?(.+)/gm,n=/^\?(\s+)?(.+)/gm,r=/^\!(\s+)?(.+)/gm;return e.match(t)?e.replace(t,"$2"):e.match(r)?e.replace(r,"[31m$2[0m"):e.match(n)?e.replace(n,"[33m$2[0m"):e}},f=E.useCallback(((e="")=>{c({title:t("reboot_device"),description:t("reboot_device_desc"),confirmationText:t("yes"),cancellationText:t("cancel")}).then((()=>{T.$.cmd(`/system/bin/svc power reboot ${e} || /system/bin/reboot ${e}`).exec()}))}),[]),_=E.useCallback((e=>{const t={...e,findBinary(e,t){const n=["/system/bin","<ADB>/ksu/bin","<ADB>/ap/bin","<ADB>/magisk"],o=e.split(",");for(const e of o)for(const o of n){const n=r(D.A.join(o,e));if(j.j.exist(n))return`${n} ${t}`}return null}};switch(T.$.getRootManager()){case"Magisk":return n("MSUINI",t);case"KernelSU":return n("KSUINI",t);case"APatchSU":return n("ASUINI",t);default:return`exit ${T.$.M_DWL_FAILURE}`}}),[]),x=()=>{l([])},b=E.useMemo((()=>({processCommand:g,lines:i,setLines:l,addButton:p,addText:u,setLastLine:d,rebootDevice:f,getInstallCLI:_,clearTerminal:x})),[g,i,l,s,a,p,u,d,f,_,x]);return(0,o.jsx)(P.Provider,{value:b,children:m})},G=()=>E.useContext(P);var W=n(53649),V=n(53295),Y=n(6627);const K=()=>{const{context:e,extra:t}=(0,i.v5)(),n=E.useRef(null),{clearTerminal:r,lines:g}=G(),[_]=(0,l.t)("term_scroll_bottom"),[x]=(0,l.t)("term_scroll_behavior"),[b]=(0,l.t)("terminal_word_wrap"),[v]=(0,l.t)("terminal_numberic_lines");if(_){const e=E.useMemo((()=>x),[x]);E.useEffect((()=>{n.current?.scrollIntoView({behavior:e.value,block:"end",inline:"nearest"})}),[g])}const[R,L]=(()=>{const e="/data/local/tmp",{extra:t}=(0,i.v5)(),[n,r]=E.useState(0),[s]=(0,l.t)("print_terminal_error"),{addText:a,addButton:c,setLastLine:m,rebootDevice:u,getInstallCLI:d}=G(),{source:p,issues:h}=t;return[async t=>new Promise(((n,i)=>{const l=t.url,g=t.printExit??!0,f=`${e}/${A()}.zip`;console.debug(f);const E=new C.f(l,f);E.onChange=t=>{switch(t.type){case"downloading":r(t.state),m(`- Downloading module progress: ${t.state}%`);break;case"finished":r(0);const l=new W.B({cwd:e,printError:s});l.env={ASH_STANDALONE:"1",MMRL:"true",MMRL_INTR:"true",MMRL_VER:V.P.VERSION_CODE.toString(),ROOTMANAGER:T.$.getRootManager()},l.onLine=e=>{a(e)},s&&(l.onError=e=>{a(`[38;5;130mâ“˜${e}`)}),l.onExit=e=>{if(j.j.deleteRecursive(f),g)switch(e){case T.$.M_INS_SUCCESS:a(" "),a("[93mYou can press the [33;4mbutton[93;0m[93m below to [33;4mreboot[93;0m[93m your device[0m"),c("Reboot",{startIcon:(0,o.jsx)(Y.A,{}),onClick:u}),a("[2mModules that causes issues after installing belong not to [35;4mMMRL[0;2m!\nPlease report these issues to their support page[2m"),h&&a(`> [32mIssues: [33m${h}[0m`),p&&a(`> [32mSource: [33m${p}[0m`);break;case T.$.M_INS_FAILURE:a(" "),a("[2mModules that cause issues after installing belong not to [35;4mMMRL[0;2m!\nPlease report these issues to their support page[2m"),h&&a(`> [32mIssues: [33m${h}[0m`),p&&a(`> [32mSource: [33m${p}[0m`);break;case T.$.TERM_INTR_ERR:a("! [31mInternal error![0m");break;default:a(`? Unknown code returned (${e}})`)}n()};try{l.exec(d({ZIPFILE:f}))}catch(e){a(`! [31mExecution error: ${e}[0m`),i(e)}}},E.onError=e=>{r(0),a("! [31mUnable to download the module[0m"),a("! [31mERR: "+e+"[0m"),i(e)},E.start()})),n]})(),[w]=(()=>{const{extra:e}=(0,i.v5)(),[t]=(0,l.t)("print_terminal_error"),{addText:n,addButton:r,rebootDevice:s,getInstallCLI:a}=G(),{modSource:c}=e;return[async e=>new Promise(((i,l)=>{const c=e.file,m=e.printExit??!0,u=new W.B({cwd:"/data/local/tmp",printError:t});u.env={ASH_STANDALONE:"1",MMRL:"true",MMRL_INTR:"true",MMRL_VER:V.P.VERSION_CODE.toString(),ROOTMANAGER:T.$.getRootManager()},u.onLine=e=>{n(e)},t&&(u.onError=e=>{n(`[38;5;130mâ“˜${e}`)}),u.onExit=e=>{if(m)switch(e){case T.$.M_INS_SUCCESS:n(" "),n("[93mYou can press the [33;4mbutton[93;0m[93m below to [33;4mreboot[93;0m[93m your device[0m"),r("Reboot",{startIcon:(0,o.jsx)(Y.A,{}),onClick:s}),n("[2mModules that causes issues after installing belong not to [35;4mMMRL[0;2m!\nPlease report these issues to their support page[2m");break;case T.$.M_INS_FAILURE:n(" "),n("[2mModules that causes issues after installing belong not to [35;4mMMRL[0;2m!\nPlease report these issues to their support page[2m");break;case T.$.TERM_INTR_ERR:n("! [31mInternal error![0m");break;default:n(`? Unknown code returned (${e}})`)}i()};try{u.exec(a({ZIPFILE:c}))}catch(e){n(`! [31mExecution error: ${e}[0m`),l(e)}}))]})(),I=E.useCallback((async()=>{const{modSource:e}=t;for(let t=0;t<e.length;t++){const n=e[t],r=t===e.length-1,o=1===e.length||r;try{await R({url:n,printExit:o})}catch(e){console.error("An error occurred during installation:",e)}}}),[]),M=E.useCallback((async()=>{const{modSource:e}=t;for(let t=0;t<e.length;t++){const n=e[t],r=t===e.length-1,o=1===e.length||r;try{await w({file:n,printExit:o})}catch(e){console.error("An error occurred during installation:",e)}}}),[]),S=E.useCallback((e=>{e.preventDefault()}),[]);E.useEffect((()=>{const{exploreInstall:e}=t;return e?I():M(),document.addEventListener("volumeupbutton",S,!1),document.addEventListener("volumedownbutton",S,!1),h.Up.addFlags([h.UD.LayoutParams.FLAG_KEEP_SCREEN_ON]),()=>{document.removeEventListener("volumeupbutton",S,!1),document.removeEventListener("volumedownbutton",S,!1),h.Up.clearFlags([h.UD.LayoutParams.FLAG_KEEP_SCREEN_ON])}}),[]);return(0,o.jsxs)(s.Y,{sx:{pl:1,pr:1,pb:"0px !important"},modifier:"noshadow",renderToolbar:()=>(0,o.jsxs)(a.M,{modifier:"noshadow",sx:{position:"relative !important"},children:[(0,o.jsx)(a.M.Left,{children:(0,o.jsx)(a.M.BackButton,{onClick:e.popPage})}),(0,o.jsx)(a.M.Center,{children:"Install"}),0!==L&&(0,o.jsx)(c.A,{sx:{width:"100%",left:0,right:0,position:"absolute",bottom:0},variant:"determinate",value:L})]}),children:[(0,o.jsx)(m.A,{sx:{display:"flex",flexWrap:"wrap"},children:(0,o.jsx)(u.A,{style:{whiteSpace:b?"unset":"pre",flex:"0 0 100%",color:"white",height:"100%",fontSize:"smaller"},direction:"column",justifyContent:"flex-start",alignItems:"stretch",spacing:0,children:(0,o.jsx)(f(),{list:g,renderItem:(e,t)=>(0,o.jsxs)(m.A,{sx:{display:"flex",":hover":{backgroundColor:(0,d.X4)("#fff",.03)},code:{wordBreak:b?"break-all":"unset"}},children:[v&&(0,o.jsx)(p.A,{sx:e=>({minWidth:"40px",paddingRight:"1em",fontSize:"unset",marginLeft:"calc(18px - 1em)",color:e.palette.text.secondary,textAlign:"right",textDecoration:"none"}),children:Number(t)+1}),(0,o.jsx)(e.component,{...e.props},t)]}),renderOnScroll:!0,renderWhenEmpty:()=>(0,o.jsx)(o.Fragment,{})})})}),(0,o.jsx)(m.A,{sx:{height:h.Up.getWindowBottomInsets()},ref:n})]})},H=()=>(0,o.jsx)(F,{children:(0,o.jsx)(K,{})}),z=H},15241:(e,t,n)=>{n.d(t,{f:()=>s});var r=n(43722),o=n(13803);class s extends r.w{_onError;_onChange;_dest;_url;constructor(e,t){super(window.__download__),this._url=e,this._dest=t}set onChange(e){this._onChange=e}set onError(e){this._onError=e}start(){if(this.isAndroid){if("function"!=typeof this._onChange)throw new TypeError("Download 'onChange' is not a function");this.interface.start({url:this._url,dest:this._dest,onChange:this._onChange,onError:this._onError})}else o.os.openURL(this._url,"_blank")}}}}]);